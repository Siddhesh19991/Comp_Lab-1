---
title: "Q 2"
output:
  pdf_document: default
  html_notebook: default
---

# Question 2
We will create a function for sampling from the double exponential (Laplace) distribution with location parameter $0$, and scale parameter $1$, with density

$$g(x) = \frac{1}{2} \cdot \exp \Big( -\abs(x) \Big)$$

The inverse distribution function $G^-1(x)$ was obtained through our [reference](https://en.wikipedia.org/wiki/Laplace_distribution) for the Laplace distribution. Below is our implementation `rlaplace` which sampl

```{r Laplace generator function}
# Inverse CDF formula from
# https://en.wikipedia.org/wiki/Laplace_distribution

# Generate laplace variates using inverse cumulative distribution function
rlaplace <- function(n=1, location=0, scale=1){
  output_vector <- c()
  u <- runif(n)
  for (i in 1:n){
    inverse_F <- location - scale*sign(u[i] - 0.5)*log(1-2*abs(u[i]-0.5))
    output_vector <- c(output_vector, inverse_F)
  }
  return(output_vector)
}

dlaplace <- function(x, location, scale){
  (scale / 2) * exp(-scale*abs(x-location))
}
```


```{r Generated Laplace plot}
hist(rlaplace(10000, 0, 1), breaks=100, freq = F)
points(x = seq(-5, 5, 0.1), y=dlaplace(seq(-5, 5, 0.1), 0, 1), type="l")
```

Looks good.

## b
We will now use the rejection sampling method (see [reference](https://en.wikipedia.org/wiki/Rejection_sampling)) to generate standard normal variates. For the envelope we will use the Laplace distribution with location parameter $0$, and scale parameter $1$, scaled appropriately by a constant $a$. In order to find the optimal $a$, we construct the following expression and then derive the optimal (maximal) $a$ that satisfies the inequality.

$$h(x) = \frac{g(x)}{f(x)} = \frac{1/2 \cdot \exp(-x)}{1/\sqrt{2\pi} \cdot \exp(-\frac{x^2}{2})} = \frac{\sqrt{\pi}}{\sqrt{2}} \cdot \exp \Big(\frac{x^2}{2} - x \Big) \geq a$$
$$h'(x) = \frac{\sqrt{\pi}}{\sqrt{2}} \cdot (x-1) \cdot \exp \Big(\frac{x^2}{2} - x \Big)$$
It is clear that $h(x)$ grows very large as $x$ approaches $\pm \infty$, and thus the lone extrema at $x = 1$ is a global minima. This implies that the optimal $a$ is

$$a = h(1) = \frac{\sqrt{\pi}}{\sqrt{2}} \cdot \exp \Big (\frac{1^2}{2} - 1 \Big) \approx 0.76 \space \text{\space (rounded down)}$$

We thus sample from the envelope

$$Y \sim e(x) = g(x)/a.$$

```{r Standard Normal generator function}
a <- sqrt(pi/2) * exp(-1/2)

# Generate standard normal variates using rejection sampling
rnorm_envelope <- function(n=1){ #mean=0, sd=1
  output_vector <- c()
  for (i in 1:n){
    repeat{
      u <- runif(1, 0, 1)
      Y <- rlaplace(1, 0, 1)
      ratio <- dnorm(Y) / (dlaplace(Y, 0, 1) / a)
      if(u <= ratio){output_vector <- c(output_vector, Y);break}
    }
  }
  return(output_vector)
}

# TO DO
# Select an appropriate "a" and insert in the code

# TEST
set.seed(9432719)
hist(rnorm_envelope(2000), breaks=100, freq = F,
     main = "Fig 2.2. Laplace sampled Normal variates",
     xlab = "x")
points(x = seq(-5, 5, 0.1), y=dnorm(seq(-5, 5, 0.1), 0, 1), type="l")
```


